<% if @restaurants.any? %>
  <% @restaurants.each do |restaurant| %>
    <%= image_tag restaurant.image.url(:thumb) %>
    <h2>
      <%= link_to restaurant.name, restaurant_path(restaurant) %>
    </h2>
    <h3>Average rating: <%= star_rating(restaurant.average_rating)  %></h3>


    <% if restaurant.reviews.any? %>
      <ul>
      <% restaurant.reviews.each do |review| %>
        <li>
          <%= review.thoughts %>
          <%= review.rating %>/5
          <%= link_to "Endorse Review", review_endorsements_path(review), class: 'endorsements-link' %>
          <span class='endorsements_count'><%=review.endorsements.count %></span>
          <%= 'endorsement'.pluralize(review.endorsements.count) %>

          <% if review.user == current_user %>
            <%= link_to "Delete Review", review_path(review), method: :delete %>
          <% end %>
        </li>
      </ul>
      <% end %>
    <% else %>
      <p>No reviews yet</p>
    <% end %>

    <% if restaurant.user == current_user %>
      <%= link_to "Edit #{restaurant.name}", edit_restaurant_path(restaurant) %>
      <%= link_to "Delete #{restaurant.name}", restaurant_path(restaurant), method: :delete %>
    <% elsif current_user && !(current_user.has_reviewed?(restaurant))%>
      <%= link_to "Review #{restaurant.name}", new_restaurant_review_path(restaurant) %>
    <% end %>
  <% end %>
<% else %>
  <h1>No restaurants yet</h1>
<% end %>

<a href="<%= new_restaurant_path %>">Add a restaurant</a>